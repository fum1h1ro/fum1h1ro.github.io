<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>мята</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="мята">
<meta property="og:url" content="https://fum1h1ro.github.io/index.html">
<meta property="og:site_name" content="мята">
<meta property="og:locale" content="ja_JP">
<meta property="article:author" content="fum1h1ro">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="мята" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">мята</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSSフィード"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="検索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://fum1h1ro.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Arduboy_move_tofu" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/30/Arduboy_move_tofu/" class="article-date">
  <time datetime="2020-03-30T11:00:00.000Z" itemprop="datePublished">2020-03-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/30/Arduboy_move_tofu/">Arduboy で豆腐を動かす</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>Arduboy で豆腐を動かすまで。</p>
<h2 id="前回までのお話"><a href="#前回までのお話" class="headerlink" title="前回までのお話"></a>前回までのお話</h2><p><a href="http://qiita.com/fum1h1ro/items/9c7fb0d072e4e6e87633" target="_blank" rel="noopener">Arduboy ことはじめ</a></p>
<h2 id="豆腐とは"><a href="#豆腐とは" class="headerlink" title="豆腐とは"></a>豆腐とは</h2><p>キャラの画も無い状態で白い四角形だけ画面上で動かすことを、豆腐を動かすと呼んでいた(要出展)時代があって、それを Arduboy でやろうという話です。</p>
<p>食べれません。</p>
<h2 id="豆腐あれと神は言った"><a href="#豆腐あれと神は言った" class="headerlink" title="豆腐あれと神は言った"></a>豆腐あれと神は言った</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Arduboy.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">Arduboy arduboy;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  arduboy.<span class="built_in">begin</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!arduboy.nextFrame()) <span class="keyword">return</span>;</span><br><span class="line">  arduboy.<span class="built_in">clear</span>();</span><br><span class="line">  arduboy.fillRect(<span class="number">128</span>/<span class="number">2</span>, <span class="number">64</span>/<span class="number">2</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">1</span>);</span><br><span class="line">  arduboy.<span class="built_in">display</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前回の使い回しですが、 <code>loop()</code> 内の <code>drawCircle()</code> が <code>fillRect()</code> に変わりました。</p>
<p>実行すると、画面の真ん中に豆腐が現れます。</p>
<p>まだ豆腐は動きません。</p>
<h2 id="そんな豆腐で大丈夫か？"><a href="#そんな豆腐で大丈夫か？" class="headerlink" title="そんな豆腐で大丈夫か？"></a>そんな豆腐で大丈夫か？</h2><p>豆腐が世界の中心からずれてる……。</p>
<p><code>fillRect()</code> 関数は、</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fillRect(<span class="keyword">int16_t</span> x, <span class="keyword">int16_t</span> y, <span class="keyword">uint8_t</span> w, <span class="keyword">uint8_t</span> h, <span class="keyword">uint8_t</span> color);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    x, y -&gt; 矩形の左上座標</span></span><br><span class="line"><span class="comment">    w -&gt; 矩形の幅</span></span><br><span class="line"><span class="comment">    h -&gt; 矩形の高さ</span></span><br><span class="line"><span class="comment">    color -&gt; 色</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>となっており、豆腐を世界の中心に持っていく、もしくは中心の座標を指定して豆腐を描画するには、指定する座標から豆腐の幅や高さを考慮してやらねばなりません。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Arduboy.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">Arduboy arduboy;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  arduboy.<span class="built_in">begin</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!arduboy.nextFrame()) <span class="keyword">return</span>;</span><br><span class="line">  arduboy.<span class="built_in">clear</span>();</span><br><span class="line">  arduboy.fillRect(<span class="number">128</span>/<span class="number">2</span><span class="number">-8</span>, <span class="number">64</span>/<span class="number">2</span><span class="number">-4</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">1</span>);</span><br><span class="line">  arduboy.<span class="built_in">display</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上記のように、XY座標から幅と高さの半分を引いてやります。</p>
<p>これで豆腐が世界の中心に据えられました。</p>
<h2 id="豆腐よ動け"><a href="#豆腐よ動け" class="headerlink" title="豆腐よ動け"></a>豆腐よ動け</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Arduboy.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">Arduboy arduboy;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  arduboy.<span class="built_in">begin</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">short x = <span class="number">0</span>; <span class="comment">// 変数を用意</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!arduboy.nextFrame()) <span class="keyword">return</span>;</span><br><span class="line">  arduboy.<span class="built_in">clear</span>();</span><br><span class="line">  arduboy.fillRect(x<span class="number">-8</span>, <span class="number">64</span>/<span class="number">2</span><span class="number">-4</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">1</span>); <span class="comment">// X座標を用意した変数に置き換える</span></span><br><span class="line">  arduboy.<span class="built_in">display</span>();</span><br><span class="line">  x = x + <span class="number">1</span>; <span class="comment">// xに1を足す </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>変数が出てきます。</p>
<p><code>setup()</code> 関数は、起動後一回だけ呼ばれます。 <code>loop()</code> 関数はその名の通り、決められた時間毎に呼ばれます。よって、 <code>loop()</code> 関数が呼ばれる度に <code>x</code> に 1 を足し続けているのが上記のコードになります。</p>
<p>実行すると、左から右へ豆腐が高速移動します。ただし、豆腐が戻ることはありません(実際には数百秒後、豆腐は宇宙の端に到達し、反対側から戻ってきます)。</p>
<h2 id="豆腐よ我が声を聞け"><a href="#豆腐よ我が声を聞け" class="headerlink" title="豆腐よ我が声を聞け"></a>豆腐よ我が声を聞け</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Arduboy.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">Arduboy arduboy;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  arduboy.<span class="built_in">begin</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">short x = <span class="number">128</span>/<span class="number">2</span>; <span class="comment">// 横座標</span></span><br><span class="line">short y = <span class="number">64</span>/<span class="number">2</span>; <span class="comment">// 縦座標</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!arduboy.nextFrame()) <span class="keyword">return</span>;</span><br><span class="line">  arduboy.<span class="built_in">clear</span>();</span><br><span class="line">  arduboy.fillRect(x<span class="number">-8</span>, y<span class="number">-4</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">1</span>); <span class="comment">// X座標を用意した変数に置き換える</span></span><br><span class="line">  arduboy.<span class="built_in">display</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ついでに縦の座標も変数にしてみました。ですが、まだ豆腐は動きません。</p>
<p>豆腐を自由自在に動かすには、 Arduboy に搭載されているボタンからの入力を受け取る必要があります。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Arduboy.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">Arduboy arduboy;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  arduboy.<span class="built_in">begin</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">short x = <span class="number">128</span>/<span class="number">2</span>; <span class="comment">// 横座標</span></span><br><span class="line">short y = <span class="number">64</span>/<span class="number">2</span>; <span class="comment">// 縦座標</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!arduboy.nextFrame()) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">if</span> (arduboy.pressed(UP_BUTTON)) &#123;</span><br><span class="line">    y -= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (arduboy.pressed(DOWN_BUTTON)) &#123;</span><br><span class="line">    y += <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (arduboy.pressed(LEFT_BUTTON)) &#123;</span><br><span class="line">    x -= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (arduboy.pressed(RIGHT_BUTTON)) &#123;</span><br><span class="line">    x += <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  arduboy.<span class="built_in">clear</span>();</span><br><span class="line">  arduboy.fillRect(x<span class="number">-8</span>, y<span class="number">-4</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">1</span>); <span class="comment">// X座標を用意した変数に置き換える</span></span><br><span class="line">  arduboy.<span class="built_in">display</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>arduboy.pressed(ボタン名)</code> でそのボタンが押されているかどうかを取得出来ます。それに応じて座標を増減します。</p>
<p><img src="/images/af8b2c59-f633-f762-d895-ddc4bf23c605.png" alt="Screen Shot 2016-06-05 at 15.27.05.png"><br><a href="https://vimeo.com/169407239" target="_blank" rel="noopener">moving tofu</a></p>
<p>豆腐が世界の中を動けるようになりました。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fum1h1ro.github.io/2020/03/30/Arduboy_move_tofu/" data-id="ck9zb3lcd00053zpkfg2d5n3v" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arduboy/" rel="tag">arduboy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qiita/" rel="tag">qiita</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Arduboy_1st" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/29/Arduboy_1st/" class="article-date">
  <time datetime="2020-03-29T11:00:00.000Z" itemprop="datePublished">2020-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/29/Arduboy_1st/">Arduboy ことはじめ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>Arduboy のセットアップから簡単なスケッチを動かすところまで解説します。</p>
<h2 id="環境セットアップ"><a href="#環境セットアップ" class="headerlink" title="環境セットアップ"></a>環境セットアップ</h2><h3 id="Arduino-IDE-をダウンロードする"><a href="#Arduino-IDE-をダウンロードする" class="headerlink" title="Arduino IDE をダウンロードする"></a>Arduino IDE をダウンロードする</h3><ul>
<li><a href="https://www.arduino.cc/" target="_blank" rel="noopener">Arduino　公式</a> から IDE をダウンロードします。</li>
</ul>
<p><img src="/images/b951bf2a-d143-bdc7-c636-234e895cd0f8.png" alt="Arduino - Home 2016-06-05 11-07-16.png"></p>
<p><code>Download</code> をクリックして先に進みます。</p>
<p><img src="/images/ba3b343a-211e-9cb6-b2ea-fe339ffd1cae.png" alt="Arduino - Software 2016-06-05 11-09-46.png"></p>
<p>右側の一覧から、自分の環境に合ったものを選びます。</p>
<p><img src="/images/ad26593a-9a37-6af2-8aeb-267000e97122.png" alt="Arduino - Donate 2016-06-05 11-14-01.png"></p>
<p>気が向いたら寄付しましょう。寄付しない場合は、 <strong>JUST DOWNLOAD</strong> で。</p>
<p>ダウンロード後、インストールします。</p>
<h3 id="Arduino-IDE-の設定"><a href="#Arduino-IDE-の設定" class="headerlink" title="Arduino IDE の設定"></a>Arduino IDE の設定</h3><p><img src="/images/71313123-79be-17b0-c654-61249c06dd51.png" alt="Screen Shot 2016-06-05 at 11.50.53.png"></p>
<p>メニューからボードを <code>Arduino Leonardo</code> にします。</p>
<p><img src="/images/06dae7bc-f90a-05b8-5a81-2eff457ab4ec.png" alt="Screen Shot 2016-06-05 at 11.52.35.png"></p>
<p>ポートも、 Arduino のものにしておくとあとで便利です。</p>
<h3 id="Arduboy-ライブラリの追加"><a href="#Arduboy-ライブラリの追加" class="headerlink" title="Arduboy ライブラリの追加"></a>Arduboy ライブラリの追加</h3><p>Arduboy でプログラムするにあたって必要なライブラリを IDE に追加します。</p>
<p><img src="/images/28e26abb-34c9-6e62-6a6d-5ad013d8c6aa.png" alt="Screen Shot 2016-06-05 at 12.08.27.png"></p>
<p>メニューの <code>Include Library &gt; Manage Libraris...</code> を選びます。</p>
<p><img src="/images/1c932faa-8a0c-5ae0-01cb-7a67a3ccd0e5.png" alt="Screen Shot 2016-06-05 at 12.10.50.png"></p>
<p>検索フィルタに <code>boy</code> と入れると、 Arduboy 用のライブラリが出てくるので、最新のバージョンをインストールします。</p>
<h3 id="Arduboy-を繋ぐ"><a href="#Arduboy-を繋ぐ" class="headerlink" title="Arduboy を繋ぐ"></a>Arduboy を繋ぐ</h3><p><img src="/images/61de1c66-1bd0-0258-34d4-bebec7e1f8c3.jpeg" alt="IMG_5323.JPG"></p>
<p>USB&lt;&gt;USB-Micro ケーブルでホスト PC と Arduboy を繋ぎます。</p>
<p>Arduboy の電源を入れると、既にインストールされているプログラムが即時実行されますが、開発中も電源入れっぱなしで、プログラムが実行されたままでも大丈夫です。</p>
<h2 id="スケッチを用意する"><a href="#スケッチを用意する" class="headerlink" title="スケッチを用意する"></a>スケッチを用意する</h2><p><img src="/images/1714a697-164d-1b00-f84f-7230a19c4206.png" alt="Screen Shot 2016-06-05 at 12.05.18.png"></p>
<p>新規スケッチを用意すると、上記画面のようになっていると思います。</p>
<p>これから、ここにプログラムを書き込んでいきます。</p>
<h2 id="スケッチに書き込む"><a href="#スケッチに書き込む" class="headerlink" title="スケッチに書き込む"></a>スケッチに書き込む</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Arduboy.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">Arduboy arduboy;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  arduboy.<span class="built_in">begin</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!arduboy.nextFrame()) <span class="keyword">return</span>;</span><br><span class="line">  arduboy.<span class="built_in">clear</span>();</span><br><span class="line">  arduboy.drawCircle(<span class="number">128</span>/<span class="number">2</span>, <span class="number">64</span>/<span class="number">2</span>, <span class="number">16</span>, <span class="number">1</span>);</span><br><span class="line">  arduboy.<span class="built_in">display</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>スケッチの中身を上記のソースに置き換えて、 Command+U （Windows なら Ctrl+U） を押して Arduboy に転送します。</p>
<p>しばらくすると、 Arduboy が起動し、真っ黒な画面の中心に円が描かれているのが確認出来ると思います。</p>
<p>これで、プリインストールされていたゲームの代わりに、あなたが書き込んだプログラムが実行されたことになります。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fum1h1ro.github.io/2020/03/29/Arduboy_1st/" data-id="ck9zb3lc500003zpk7w03ab73" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arduboy/" rel="tag">arduboy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qiita/" rel="tag">qiita</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Arduboy_OLED" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/29/Arduboy_OLED/" class="article-date">
  <time datetime="2020-03-29T11:00:00.000Z" itemprop="datePublished">2020-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/29/Arduboy_OLED/">Arduboy のOLEDを叩く</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>OLED に直接制御コマンドを流し込みます。</p>
<p>今回はあまり実用的でも初心者向けでもありません。</p>
<h1 id="ハードウェア的な話"><a href="#ハードウェア的な話" class="headerlink" title="ハードウェア的な話"></a>ハードウェア的な話</h1><h2 id="OLED-の型番"><a href="#OLED-の型番" class="headerlink" title="OLED の型番"></a>OLED の型番</h2><p><a href="https://github.com/Arduboy/Arduboy/blob/master/src/core/core.h#L112" target="_blank" rel="noopener">https://github.com/Arduboy/Arduboy/blob/master/src/core/core.h#L112</a></p>
<p>分解しなくてもライブラリに書いてあったのですぐわかりました。</p>
<h2 id="OLED-のデータシート（マニュアル"><a href="#OLED-のデータシート（マニュアル" class="headerlink" title="OLED のデータシート（マニュアル)"></a>OLED のデータシート（マニュアル)</h2><p><a href="https://cdn-shop.adafruit.com/datasheets/SSD1306.pdf" target="_blank" rel="noopener">https://cdn-shop.adafruit.com/datasheets/SSD1306.pdf</a></p>
<p>英語ですが、マニュアルがありました。</p>
<h1 id="ソフトウェア的な話"><a href="#ソフトウェア的な話" class="headerlink" title="ソフトウェア的な話"></a>ソフトウェア的な話</h1><h2 id="コマンドの送り方"><a href="#コマンドの送り方" class="headerlink" title="コマンドの送り方"></a>コマンドの送り方</h2><p><code>ArduboyCore</code> クラス( <code>Arduboy</code> クラスのベースクラス )に、関数があります。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="keyword">static</span> <span class="title">LCDDataMode</span><span class="params">()</span></span>; <span class="comment">//&lt; put the display in data mode</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="keyword">static</span> <span class="title">LCDCommandMode</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="keyword">static</span> <span class="title">sendLCDCommand</span><span class="params">(<span class="keyword">uint8_t</span> command)</span></span>;</span><br></pre></td></tr></table></figure>

<p>名前についてツッコむのは野暮ってもんです。</p>
<ul>
<li><code>LCDDataMode()</code> は OLED の受信モードを、表示データを受信するモードにします</li>
<li><code>LCDCommandMode()</code> は OLED の受信モードを、制御コマンドを受信するモードにします</li>
<li><code>sendLCDCommand()</code> は、上記二つを自動で発行し、その間に 1byte の制御コマンドを送信する便利関数です</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ArduboyCore::sendLCDCommand</span><span class="params">(<span class="keyword">uint8_t</span> command)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  LCDCommandMode();</span><br><span class="line">  <span class="built_in">SPI</span>.<span class="built_in">transfer</span>(command);</span><br><span class="line">  LCDDataMode();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>コアライブラリは、常に表示データ受信モードになっている前提で作られているので、受信モードを変更したあとは必ず戻すようにしておきます。</p>
<h2 id="試しに送ってみる"><a href="#試しに送ってみる" class="headerlink" title="試しに送ってみる"></a>試しに送ってみる</h2><p>コントラストを変更するコマンドを発見したので、試しに送ってみます。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">u8 c = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!boy.nextFrame()) <span class="keyword">return</span>;</span><br><span class="line">  boy.<span class="built_in">clear</span>();</span><br><span class="line">  boy.fillScreen(<span class="number">1</span>);</span><br><span class="line">  boy.<span class="built_in">display</span>();</span><br><span class="line">  boy.LCDCommandMode();</span><br><span class="line">  <span class="built_in">SPI</span>.<span class="built_in">transfer</span>(<span class="number">0x81</span>);</span><br><span class="line">  <span class="built_in">SPI</span>.<span class="built_in">transfer</span>(c++);</span><br><span class="line">  boy.LCDDataMode();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>setup()</code> 関数等は省略しますが、上記のソースでコントラストを 0〜255 に変化しま……す？</p>
<p>確かに変化はしましたが、真っ暗までにはならず、また階調も三階調ほどしか変化しないようでした。残念。フェードイン・フェードアウトに使えるかと思ったのですが(‘ω`)</p>
<h2 id="おわり"><a href="#おわり" class="headerlink" title="おわり"></a>おわり</h2><p>データシートを読むと他にも色々面白そうな制御コマンドがあるので、色々試してみると面白いかもしれません。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fum1h1ro.github.io/2020/03/29/Arduboy_OLED/" data-id="ck9zb3lc900013zpk655s2yjh" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arduboy/" rel="tag">arduboy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qiita/" rel="tag">qiita</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Arduboy_framebuffer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/29/Arduboy_framebuffer/" class="article-date">
  <time datetime="2020-03-29T11:00:00.000Z" itemprop="datePublished">2020-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/29/Arduboy_framebuffer/">Arduboy のフレームバッファ</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>Arduboy の画面に色々表示させるために、フレームバッファの構造について検証します。</p>
<h2 id="フレームバッファの構造"><a href="#フレームバッファの構造" class="headerlink" title="フレームバッファの構造"></a>フレームバッファの構造</h2><p>1bit が 1 ドットに対応しており、 1 バイト毎に縦に並んでいる。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span>* ptr = arduboy.getBuffer();</span><br></pre></td></tr></table></figure>

<p>として、 <code>ptr</code> の添え字と座標の関係は以下の表の通り。</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">x0</th>
<th align="center">x1</th>
<th align="center">x2</th>
<th align="center">…</th>
<th align="center">x127</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><strong>y0-y7</strong></td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">…</td>
<td align="center">127</td>
</tr>
<tr>
<td align="center"><strong>y8-y15</strong></td>
<td align="center">128</td>
<td align="center">129</td>
<td align="center">130</td>
<td align="center">…</td>
<td align="center">255</td>
</tr>
<tr>
<td align="center"><strong>:</strong></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><strong>y48-y55</strong></td>
<td align="center">768</td>
<td align="center">769</td>
<td align="center">770</td>
<td align="center">…</td>
<td align="center">895</td>
</tr>
<tr>
<td align="center"><strong>y56-y63</strong></td>
<td align="center">896</td>
<td align="center">897</td>
<td align="center">898</td>
<td align="center">…</td>
<td align="center">1023</td>
</tr>
</tbody></table>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> ptr = arduboy.getBuffer();</span><br><span class="line">ptr[<span class="number">0</span>] = <span class="number">0xff</span>; <span class="comment">// 1111_1111</span></span><br><span class="line">ptr[<span class="number">8</span>] = <span class="number">0x11</span>; <span class="comment">// 0001_0001</span></span><br><span class="line">ptr[<span class="number">16</span>] = <span class="number">0xa7</span>; <span class="comment">// 1010_0111</span></span><br></pre></td></tr></table></figure>

<p>例えば上記のように描き込んだ場合は、</p>
<p><img src="/images/8683a246-e816-2bae-e7cf-8c569ad78dfa.png" alt="screenshot.png"></p>
<p>このように表示されます。</p>
<p>このことから、ビットの対応は、</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">bit</th>
</tr>
</thead>
<tbody><tr>
<td align="center">y0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">y1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">y2</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">y3</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">y4</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">y5</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">y6</td>
<td align="center">6</td>
</tr>
<tr>
<td align="center">y7</td>
<td align="center">7</td>
</tr>
</tbody></table>
<p>になってることがわかりました。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fum1h1ro.github.io/2020/03/29/Arduboy_framebuffer/" data-id="ck9zb3lcb00033zpkafo252za" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arduboy/" rel="tag">arduboy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qiita/" rel="tag">qiita</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Arduboy_measure_1frame" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/29/Arduboy_measure_1frame/" class="article-date">
  <time datetime="2020-03-29T11:00:00.000Z" itemprop="datePublished">2020-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/29/Arduboy_measure_1frame/">1フレームの時間を測る</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>ﾋｬｯﾊｰ！約60fpsだぜ！</p>
<h2 id="計測してみる"><a href="#計測してみる" class="headerlink" title="計測してみる"></a>計測してみる</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Arduboy.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">Arduboy boy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">signed</span> <span class="keyword">char</span> s8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">signed</span> short s16;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">signed</span> <span class="keyword">int</span> s32;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> u8;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> short u16;</span><br><span class="line"><span class="comment">//typedef unsigned int u32;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">signed</span> short fx16;</span><br><span class="line"></span><br><span class="line">s16 x = <span class="number">0</span>;</span><br><span class="line">s32 cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> frameload = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> prev_count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FX16_SHIFT (7)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FX16_ONE (1&lt;&lt;FX16_SHIFT)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FX16_CONST(v) ((s16)((v) * 128.0f))</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FX16_TOINT(v) ((v)&gt;&gt;FX16_SHIFT)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FX16_MUL(a, b) (((a)*(b))&gt;&gt;FX16_SHIFT)</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> FX16_DIV(a, b) ((s16)(((s32)(a)&lt;&lt;FX16_SHIFT)/(b)))</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Object</span> &#123;</span></span><br><span class="line">  fx16 x, y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Object obj;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (boy.pressed(LEFT_BUTTON)) &#123;</span><br><span class="line">    obj.x -= FX16_CONST(<span class="number">1.5f</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (boy.pressed(RIGHT_BUTTON)) &#123;</span><br><span class="line">    obj.x += FX16_CONST(<span class="number">1.5f</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (boy.pressed(UP_BUTTON)) &#123;</span><br><span class="line">    obj.y -= FX16_CONST(<span class="number">1.5f</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (boy.pressed(DOWN_BUTTON)) &#123;</span><br><span class="line">    obj.y += FX16_CONST(<span class="number">1.5f</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  boy.drawCircle(FX16_TOINT(obj.x), FX16_TOINT(obj.y), <span class="number">8</span>, <span class="number">0xff</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  boy.<span class="built_in">begin</span>();</span><br><span class="line">  boy.setFrameRate(<span class="number">60</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!boy.nextFrame()) <span class="keyword">return</span>;</span><br><span class="line">  <span class="keyword">auto</span> now = <span class="built_in">micros</span>();</span><br><span class="line">  frameload = now - prev_count;</span><br><span class="line">  prev_count = now;</span><br><span class="line">  boy.<span class="built_in">clear</span>();</span><br><span class="line">  update();</span><br><span class="line">  boy.<span class="built_in">display</span>();</span><br><span class="line">  <span class="keyword">if</span> (++cnt &gt; <span class="number">60</span>) &#123;</span><br><span class="line">    <span class="built_in">Serial</span>.<span class="built_in">println</span>(frameload);</span><br><span class="line">    cnt = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>関係ないコードも混じってますが、とりあえず、毎フレーム <code>micros()</code> で起動後から経過した時間を取得して、一秒に一回シリアルへ出力。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[k-ya@meteor] ~&#x2F;Documents&#x2F;Arduino&#x2F;build</span><br><span class="line">% picocom &#x2F;dev&#x2F;cu.usbmodem1411</span><br><span class="line">picocom v2.1</span><br><span class="line"></span><br><span class="line">port is        : &#x2F;dev&#x2F;cu.usbmodem1411</span><br><span class="line">flowcontrol    : none</span><br><span class="line">baudrate is    : 9600</span><br><span class="line">parity is      : none</span><br><span class="line">databits are   : 8</span><br><span class="line">stopbits are   : 1</span><br><span class="line">escape is      : C-a</span><br><span class="line">local echo is  : no</span><br><span class="line">noinit is      : no</span><br><span class="line">noreset is     : no</span><br><span class="line">nolock is      : no</span><br><span class="line">send_cmd is    : sz -vv</span><br><span class="line">receive_cmd is : rz -vv -E</span><br><span class="line">imap is        : </span><br><span class="line">omap is        : </span><br><span class="line">emap is        : crcrlf,delbs,</span><br><span class="line"></span><br><span class="line">Type [C-a] [C-h] to see available commands</span><br><span class="line"></span><br><span class="line">Terminal ready</span><br><span class="line">16384</span><br><span class="line">16384</span><br><span class="line">16384</span><br><span class="line">16384</span><br><span class="line">16384</span><br><span class="line">15360</span><br><span class="line">15360</span><br><span class="line">15360</span><br><span class="line">16384</span><br><span class="line">16384</span><br><span class="line">16384</span><br><span class="line">16384</span><br><span class="line">16384</span><br><span class="line">15360</span><br><span class="line">15368</span><br><span class="line"></span><br><span class="line">Thanks for using picocom</span><br></pre></td></tr></table></figure>

<p>タイマー精度の関係なのか、16384というこれはこれでキリのいい数字が出ているが、大体60fps出ているようだ。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fum1h1ro.github.io/2020/03/29/Arduboy_measure_1frame/" data-id="ck9zb3lcc00043zpkfxefdcg0" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arduboy/" rel="tag">arduboy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qiita/" rel="tag">qiita</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Arduboy_road_to" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/29/Arduboy_road_to/" class="article-date">
  <time datetime="2020-03-29T11:00:00.000Z" itemprop="datePublished">2020-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/29/Arduboy_road_to/">Arduboy への道</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>Arduboy が届かなさすぎておかしくなった頭を冷やすための記事です。</p>
<h2 id="小ネタ"><a href="#小ネタ" class="headerlink" title="小ネタ"></a>小ネタ</h2><h3 id="外部エディタで書きたい"><a href="#外部エディタで書きたい" class="headerlink" title="外部エディタで書きたい"></a>外部エディタで書きたい</h3><ul>
<li>書いてもいいけど、そのままだと IDE に変更が反映されない</li>
<li><code>Preferences &gt; Use external editor</code> を有効にする</li>
<li>IDE から編修出来なくなるけど、外部エディタで編集して IDE に戻るとファイルを読み込み直してくれる</li>
</ul>
<h3 id="逆アセンブルしたい-or-コンパイルした結果がどうなってるか知りたい"><a href="#逆アセンブルしたい-or-コンパイルした結果がどうなってるか知りたい" class="headerlink" title="逆アセンブルしたい or コンパイルした結果がどうなってるか知りたい"></a>逆アセンブルしたい or コンパイルした結果がどうなってるか知りたい</h3><ol>
<li>コンパイルした結果を取得出来るようにする<ul>
<li><a href="http://mpu.seesaa.net/article/434274452.html" target="_blank" rel="noopener">Arduino/Genuino 101 の追加メモ 2016/02</a> を参考にする。この記事は Windows 版向けだけど、OSX 版でも同じようにできる。</li>
<li><code>~/Library/Arduino15/preferences.txt</code> を編集。 <code>build.path=ビルド結果を出力するパス</code> を追加する</li>
<li>権限的に問題ないパスを指定するよう注意 ex) <code>/Users/Hoge/Documents/Arduino/build</code></li>
</ul>
</li>
<li>逆アセンブルする<ul>
<li><code>/Applications/Arduino.app/Contents/Java/hardware/tools/avr/bin</code> に色々入ってるのでそれを使う</li>
<li>適当にパスを通すなどして</li>
<li><code>% avr-objdump -hdSC hoge.elf &gt; hoge.txt</code></li>
</ul>
</li>
<li>読む</li>
</ol>
<ul>
<li>実際に転送されるのは、 <code>hoge.ino.hex</code> なのかな？</li>
<li>この辺は Arduino の文献を漁った方がよさそう</li>
</ul>
<h3 id="早く受け取りたい"><a href="#早く受け取りたい" class="headerlink" title="早く受け取りたい"></a>早く受け取りたい</h3><ul>
<li>日本の国際交換局に到着した段階で直接交換局に行き、受け取ることが可能らしい -&gt; <a href="http://jetstream.bz/archives/17615" target="_blank" rel="noopener">早期通関申請</a></li>
<li>行く気満々だったが、タッチの差で発送されてしまった</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fum1h1ro.github.io/2020/03/29/Arduboy_road_to/" data-id="ck9zb3lce00073zpk6rhzfz40" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arduboy/" rel="tag">arduboy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qiita/" rel="tag">qiita</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Arduboy_using_latest_lib" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/29/Arduboy_using_latest_lib/" class="article-date">
  <time datetime="2020-03-29T11:00:00.000Z" itemprop="datePublished">2020-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/29/Arduboy_using_latest_lib/">常に最新の Arduboy ライブラリを使う</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>Arduino IDE によるライブラリ管理では満足出来ない御仁のための TIPS です。</p>
<h1 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h1><p><a href="http://qiita.com/fum1h1ro/items/9c7fb0d072e4e6e87633" target="_blank" rel="noopener">Arduboy ことはじめ</a></p>
<p>上記の記事で、Arduino IDE の Manage Libraries を使って、Arduboy のコアライブラリをインストールしましたが、残念ながらあそこから入るのは最新ではありません。</p>
<p>最新は、Github 上のリポジトリから入手可能です。</p>
<h1 id="入手方法"><a href="#入手方法" class="headerlink" title="入手方法"></a>入手方法</h1><h2 id="古いライブラリを消す"><a href="#古いライブラリを消す" class="headerlink" title="古いライブラリを消す"></a>古いライブラリを消す</h2><p>Arduino IDE を終了させた状態で、 <code>~/Documents/Arduino/libraries/Arduboy</code> フォルダをざっくり消します。</p>
<h2 id="新しいライブラリを入れる"><a href="#新しいライブラリを入れる" class="headerlink" title="新しいライブラリを入れる"></a>新しいライブラリを入れる</h2><h3 id="ターミナルを起動する"><a href="#ターミナルを起動する" class="headerlink" title="ターミナルを起動する"></a>ターミナルを起動する</h3><p>黒い画面を開きます。</p>
<h3 id="Github-から-clone-する"><a href="#Github-から-clone-する" class="headerlink" title="Github から clone する"></a>Github から clone する</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[k-ya@meteor] ~</span><br><span class="line">% cd Documents&#x2F;Arduino&#x2F;libraries</span><br><span class="line">[k-ya@meteor] ~&#x2F;Documents&#x2F;Arduino&#x2F;libraries</span><br><span class="line">% git clone https:&#x2F;&#x2F;github.com&#x2F;Arduboy&#x2F;Arduboy.git</span><br><span class="line">Cloning into &#39;Arduboy&#39;...</span><br><span class="line">remote: Counting objects: 1148, done.</span><br><span class="line">remote: Total 1148 (delta 0), reused 0 (delta 0), pack-reused 1148</span><br><span class="line">Receiving objects: 100% (1148&#x2F;1148), 295.96 KiB | 160.00 KiB&#x2F;s, done.</span><br><span class="line">Resolving deltas: 100% (664&#x2F;664), done.</span><br><span class="line">Checking connectivity... done.</span><br><span class="line">[k-ya@meteor] ~&#x2F;Documents&#x2F;Arduino&#x2F;libraries</span><br><span class="line">%</span><br></pre></td></tr></table></figure>

<p><code>~/Documents/Arduino/libraries</code> へ移動し、Github からクローンします。</p>
<p>これで、最新のライブラリがインストールされました。</p>
<h2 id="常に最新に保つ"><a href="#常に最新に保つ" class="headerlink" title="常に最新に保つ"></a>常に最新に保つ</h2><p>最新だから良いというわけではありませんが、最新版を追っかけたい場合は、ターミナルから、 <code>~/Documents/Arduino/libraries/Arduino</code> へ移動し、</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[k-ya@meteor] ~&#x2F;Documents&#x2F;Arduino&#x2F;libraries&#x2F;Arduino</span><br><span class="line">% git pull origin master</span><br></pre></td></tr></table></figure>

<p>とすると、更新のあったファイルを落としてくることが出来ます。</p>
<h2 id="おわり"><a href="#おわり" class="headerlink" title="おわり"></a>おわり</h2><p>Arduino IDE からインストール出来る 1.1.0 から最新の 1.2.0 では、文字表示ライブラリが追加されていたり、サウンドの処理からデフォルトの割り込みベクタがなくなっていたりして、結構変わっているようです。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fum1h1ro.github.io/2020/03/29/Arduboy_using_latest_lib/" data-id="ck9zb3lcf00083zpkg5101k8o" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/arduboy/" rel="tag">arduboy</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qiita/" rel="tag">qiita</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-GBuffer_helper_Packing_integer_and_float_together" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/29/GBuffer_helper_Packing_integer_and_float_together/" class="article-date">
  <time datetime="2020-03-29T11:00:00.000Z" itemprop="datePublished">2020-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/29/GBuffer_helper_Packing_integer_and_float_together/">GBuffer helper – Packing integer and float together</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>この記事は、<a href="https://seblagarde.wordpress.com/2018/09/02/gbuffer-helper-packing-integer-and-float-together/" target="_blank" rel="noopener">こちら</a>の記事を日本語に翻訳したものです(翻訳の許可は取っています)。</p>
<blockquote>
<p>Version : 1.0 – Living blog</p>
</blockquote>
<blockquote>
<p>With GBuffer approach, it is often required to pack values together. One useful case is to be able to pack an integer value (often matching an enum like material ID) and a float value (inside 0..1 range).</p>
</blockquote>
<p>GBufferを利用するアプローチにおいて頻繁に様々な値をパックする必要がある。特によく使われるのは、整数値（マテリアルIDのような列挙型）と浮動小数値（0〜1の間）をパックするようなケースだ。</p>
<blockquote>
<p>For example in Unity High Definition Render Pipeline we have pack inside the GBuffer:</p>
</blockquote>
<p>UnityのHDPRにおけるGBuffer内部では以下のようなパッキングを行っている。</p>
<blockquote>
<ul>
<li>DiffusionProfile (16 values) and Subsurface Mask (Float 0..1)</li>
<li>Material Features (8 values) and Coat Mask (Float 0..1)</li>
<li>Quadrant for tangent frame (8 values) and metallic (Float 0..1)</li>
</ul>
</blockquote>
<ul>
<li>拡散反射タイプ（16個）とサブサーフェスマスク（浮動小数点数0..1）</li>
<li>マテリアル効果（8個）とコートマスク（浮動小数点数0..1）</li>
<li>接線空間における象限（16個）とメタリック値（浮動小数点数0..1）</li>
</ul>
<blockquote>
<p>During development we have change several times the number of bit required for our packing and it quickly come to us that we were needed to have general packing functions to encode arbitrary values. This is the topic of this short blog post.</p>
</blockquote>
<p>開発中、我々は幾度となくパック中のビット数を変更し、我々が任意の値をパックするためにパッキング関数が必要なことにすぐ気づいた。これは、このブログポストのトピックである。</p>
<blockquote>
<p>Let’s say that we want to encode a Mask on 1 bit with a Scalar in range 0..1 with 8 bit of precision inside a shader. Mean in practice we pack both values in a component of a RGBA 32bit render target. Remember that the float value in the shader is convert at the end of the pipeline to corresponding render target format, in our case the float value will be multiply by 255 to fit into the 8bit precision of the component. We will have 7 bits to encode the float, this could be perform with a simple remapping:</p>
</blockquote>
<p>さて、我々は1bitのマスクと0..1のスカラー値を8bit精度にエンコードしたいと思っている。これは、双方の値をRGBA32レンダーターゲットの1要素へパックすることである。忘れないで欲しいのは、シェーダ内の浮動小数点数はパイプラインの最後で対応するレンダーターゲットのフォーマットに変換される。今回の場合、浮動小数点数は255を掛けられて8bit精度の要素になる。我々は7bitを浮動小数点数のエンコードに使う。これはシンプルな変換式で実行できる。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">127.0</span> * Scalar)  / <span class="number">255.0</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>multiply by 127 (or (1 &lt;&lt; 7) – 1) which is 01111111 in binaries leave 1 bit available for the Mask.</p>
</blockquote>
<p>二進数で0b01111111である127（もしくは<code>(1&lt;&lt;7)-1</code>）を掛けることで、1bitをマスクのために使えるようになる。</p>
<blockquote>
<p>Then we divide by 255.0</p>
</blockquote>
<p>そして、255で割る。</p>
<blockquote>
<p>Then we need to add the bit for the mask itself at the 8th position mean value of 128 (or (1 &lt;&lt; 8) – 1)</p>
</blockquote>
<p>そして、我々はマスクのために、8番目のbitである128(もしくは<code>(1&lt;&lt;8)-1</code>)を足す。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">128.0</span> * Mask) / <span class="number">255.0</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>So encoding is</p>
</blockquote>
<p>そしてエンコード式は</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Val = (<span class="number">127.0</span> / <span class="number">255.0</span>) * Scalar + (<span class="number">128.0</span> / <span class="number">255.0</span>) * Mask</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Decoding should be the reverse of the operation above. First we need to retrieve the Mask value</p>
</blockquote>
<p>デコードは、上記の式と反対を行う必要がある。まず最初に、マスク値から取得する。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mask = <span class="keyword">int</span>((<span class="number">255.0</span> / <span class="number">128.0</span>) * Val)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Note that here we use the int cast to remove all the Scalar value part.<br>For example if we have Scalar of 0 and Mask with 1, Val is suppose to be 128.0 / 255.0.<br>Mean the above code give us 1</p>
</blockquote>
<p>ここでは、スカラー値部分をそぎ落とすためにintキャストを使う。<br>例えば、スカラー値0とマスク値1を持つ場合、<code>Val</code>は<code>128.0/255.0</code>になるはずだ。<br>この場合、上記の式は1を返すことになる。</p>
<blockquote>
<p>if Scalar is 1, Val is suppose to be 1.0, mean Mask = int(1.9921875) = 1. All good.</p>
</blockquote>
<p>もし、スカラー値が1の場合、<code>Val</code>は1.0になるはずだ。これは、<code>Mask = int(1.9921875) = 1</code>となるので、バッチリだ。</p>
<blockquote>
<p>We then retrieve the value of Scalar</p>
</blockquote>
<p>次にスカラー値を取り出す。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Scalar = (Val - (<span class="number">128.0</span> / <span class="number">255.0</span>) * <span class="keyword">float</span>(Mask)) / (<span class="number">127.0</span> / <span class="number">255.0</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Now let’s consider a RGBA1010102 render target with a Mask on 4 bit. The process is exactly the same.<br>First remap value to cover 6 bit for the float value and 4 bit for the Mask value</p>
</blockquote>
<p>今、RGBA1010102のレンダーターゲットで、4bitマスクを持つ場合を考えてみよう。手順は先ほどと同じ。<br>まず、浮動小数点数を6bit、マスク値を4bitに再マップする。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Val = (<span class="number">63.0</span> / <span class="number">1023.0</span>) * Scalar + (<span class="number">64.0</span> / <span class="number">1023.0</span>) * Mask</span><br></pre></td></tr></table></figure>

<blockquote>
<p>For example if Mask is 2 (i.e 128.0 / 1023.0) and Scalar is 1.0 we get 0010 1111 11 as binaries representation.<br>4 bit for Mask then 6 bit for Scalar.</p>
</blockquote>
<p>例えば、マスク値が2(すなわち128.0/1023.0)とスカラー値が1.0の時、0b0010_1111_11が得られる。<br>4bitがマスク値、6bitがスカラー値に使われている。</p>
<blockquote>
<p>For decoding we first retrieve the Mask then the Scalar</p>
</blockquote>
<p>デコードは、まずマスク値、そしてスカラー値の順に取り出す。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Mask = <span class="keyword">int</span>((<span class="number">1023.0</span> / <span class="number">64.0</span>) * Val)</span><br><span class="line">Scalar = (Val - (<span class="number">64.0</span> / <span class="number">1023.0</span>) * <span class="keyword">float</span>(Mask)) / (<span class="number">63.0</span> / <span class="number">1023.0</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Important addition.<br>Due to rounding and floating point calculation on GPU it may appear that Mask reconstruction is shifted by one value.<br>This can be fixed by adding the smallest epsilon allowed by the render target format. i.e</p>
</blockquote>
<p>重要なことがある。<br>GPU中で浮動小数点演算や丸めが行われる間に、マスクの再構成は一つの値によってずらされるように見えるかもしれない。（訳注：？）<br>これは、レンダーターゲットに許容される最小値を足すことで回避できる。すなわち、</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mask = <span class="keyword">int</span>((<span class="number">1023.0</span> / <span class="number">64.0</span>) * Val + <span class="number">1.0</span> / <span class="number">1023.0</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>We can easily generalize this process for any unsigned render target format and any Mask size. Here are the functions to do the work.</p>
</blockquote>
<p>我々は簡単にこれらの手順を、様々な符号なしレンダーターゲットフォーマット、及び様々なマスクサイズに対して一般化できる。<br>ここに動く関数がある。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">PackFloatInt</span><span class="params">(<span class="keyword">float</span> f, uint i, uint numBitI, uint numBitTarget)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Constant optimize by compiler</span></span><br><span class="line">    <span class="keyword">float</span> precision = <span class="keyword">float</span>(<span class="number">1</span> &lt;&lt; numBitTarget);</span><br><span class="line">    <span class="keyword">float</span> maxi = <span class="keyword">float</span>(<span class="number">1</span> &lt;&lt; numBitI);</span><br><span class="line">    <span class="keyword">float</span> precisionMinusOne = precision - <span class="number">1.0</span>;</span><br><span class="line">    <span class="keyword">float</span> t1 = ((precision / maxi) - <span class="number">1.0</span>) / precisionMinusOne;</span><br><span class="line">    <span class="keyword">float</span> t2 = (precision / maxi) / precisionMinusOne;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Code</span></span><br><span class="line">    <span class="keyword">return</span> t1 * f + t2 * <span class="keyword">float</span>(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UnpackFloatInt</span><span class="params">(<span class="keyword">float</span> val, uint numBitI, uint numBitTarget, out <span class="keyword">float</span> f, out uint i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Constant optimize by compiler</span></span><br><span class="line">    <span class="keyword">float</span> precision = <span class="keyword">float</span>(<span class="number">1</span> &lt;&lt; numBitTarget);</span><br><span class="line">    <span class="keyword">float</span> maxi = <span class="keyword">float</span>(<span class="number">1</span> &lt;&lt; numBitI);</span><br><span class="line">    <span class="keyword">float</span> precisionMinusOne = precision - <span class="number">1.0</span>;</span><br><span class="line">    <span class="keyword">float</span> t1 = ((precision / maxi) - <span class="number">1.0</span>) / precisionMinusOne;</span><br><span class="line">    <span class="keyword">float</span> t2 = (precision / maxi) / precisionMinusOne;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Code</span></span><br><span class="line">    <span class="comment">// extract integer part</span></span><br><span class="line">    <span class="comment">// + rcp(precisionMinusOne) to deal with precision issue</span></span><br><span class="line">    i = <span class="keyword">int</span>((val / t2) + rcp(precisionMinusOne));</span><br><span class="line">    <span class="comment">// Now that we have i, solve formula in PackFloatInt for f</span></span><br><span class="line">    <span class="comment">//f = (val - t2 * float(i)) / t1 =&gt; convert in mads form</span></span><br><span class="line">    f = saturate((-t2 * <span class="keyword">float</span>(i) + val) / t1); <span class="comment">// Saturate in case of precision issue</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Define various variants for ease of use and code read</span></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">PackFloatInt8bit</span><span class="params">(<span class="keyword">float</span> f, uint i, uint numBitI)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> PackFloatInt(f, i, numBitI, <span class="number">8</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UnpackFloatInt8bit</span><span class="params">(<span class="keyword">float</span> val, uint numBitI, out <span class="keyword">float</span> f, out uint i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    UnpackFloatInt(val, numBitI, <span class="number">8</span>, f, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">PackFloatInt10bit</span><span class="params">(<span class="keyword">float</span> f, uint i, uint numBitI)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> PackFloatInt(f, i, numBitI, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UnpackFloatInt10bit</span><span class="params">(<span class="keyword">float</span> val, uint numBitI, out <span class="keyword">float</span> f, out uint i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    UnpackFloatInt(val, numBitI, <span class="number">10</span>, f, i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">PackFloatInt16bit</span><span class="params">(<span class="keyword">float</span> f, uint i, uint numBitI)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> PackFloatInt(f, i, numBitI, <span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">UnpackFloatInt16bit</span><span class="params">(<span class="keyword">float</span> val, uint numBitI, out <span class="keyword">float</span> f, out uint i)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    UnpackFloatInt(val, numBitI, <span class="number">16</span>, f, i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>And example usage:</p>
</blockquote>
<p>それと使い方。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Encode</span></span><br><span class="line">outSSSBuffer0.a = PackFloatInt8bit(sssData.subsurfaceMask, sssData.diffusionProfile, <span class="number">4</span>);</span><br><span class="line"><span class="comment">// Decode</span></span><br><span class="line">UnpackFloatInt8bit(inSSSBuffer0.a, <span class="number">4</span>, sssData.subsurfaceMask, sssData.diffusionProfile);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Encode</span></span><br><span class="line">outGBuffer2.a  = PackFloatInt8bit(coatMask, materialFeatureId, <span class="number">3</span>);</span><br><span class="line"><span class="comment">// Decode</span></span><br><span class="line"><span class="keyword">float</span> coatMask;</span><br><span class="line">uint materialFeatureId;</span><br><span class="line">UnpackFloatInt8bit(inGBuffer2.a, <span class="number">3</span>, coatMask, materialFeatureId);</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fum1h1ro.github.io/2020/03/29/GBuffer_helper_Packing_integer_and_float_together/" data-id="ck9zb3lcg000a3zpk8m5nehoo" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qiita/" rel="tag">qiita</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Kiyoshi_Check" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/29/Kiyoshi_Check/" class="article-date">
  <time datetime="2020-03-29T11:00:00.000Z" itemprop="datePublished">2020-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/29/Kiyoshi_Check/">例のキヨシチェックを Sprache で書いてみる</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p><a href="http://qiita.com/beinteractive/items/a2264048a601ee998aca" target="_blank" rel="noopener">http://qiita.com/beinteractive/items/a2264048a601ee998aca</a></p>
<p>例の(?)が何だか解らないんですが、こういうのが上がってきたので、パーサの練習がてら書いてみました。</p>
<h2 id="使ったもの"><a href="#使ったもの" class="headerlink" title="使ったもの"></a>使ったもの</h2><p><a href="https://github.com/sprache/Sprache" target="_blank" rel="noopener">https://github.com/sprache/Sprache</a></p>
<p>C# の Monadic Parser だそうです。Monadic って Haskell で出てきたモナド的なヤツでしょうか。</p>
<h2 id="できたもの"><a href="#できたもの" class="headerlink" title="できたもの"></a>できたもの</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> Sprache;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ZundokoGenerator</span> &#123;</span><br><span class="line">  Random _random = <span class="keyword">new</span> Random();</span><br><span class="line">  <span class="function"><span class="keyword">public</span> IEnumerator&lt;<span class="keyword">string</span>&gt; <span class="title">RandomZunDoko</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">      <span class="keyword">yield</span> <span class="keyword">return</span> _random.Next(<span class="number">0</span>, <span class="number">2</span>) == <span class="number">0</span> ? <span class="string">"ズン"</span> : <span class="string">"ドコ"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">KiyoshiParser</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Parser&lt;<span class="keyword">string</span>&gt; zun =</span><br><span class="line">    <span class="keyword">from</span> txt <span class="keyword">in</span> Parse.String(<span class="string">"ズン"</span>).Text()</span><br><span class="line">    <span class="keyword">select</span> txt;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Parser&lt;<span class="keyword">string</span>&gt; doko =</span><br><span class="line">    <span class="keyword">from</span> txt <span class="keyword">in</span> Parse.String(<span class="string">"ドコ"</span>).Text()</span><br><span class="line">    <span class="keyword">select</span> txt;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">readonly</span> Parser&lt;<span class="keyword">string</span>&gt; zzzd =</span><br><span class="line">    <span class="keyword">from</span> z0 <span class="keyword">in</span> zun</span><br><span class="line">    <span class="keyword">from</span> z1 <span class="keyword">in</span> zun</span><br><span class="line">    <span class="keyword">from</span> z2 <span class="keyword">in</span> zun</span><br><span class="line">    <span class="keyword">from</span> z3 <span class="keyword">in</span> zun</span><br><span class="line">    <span class="keyword">from</span> dk <span class="keyword">in</span> doko</span><br><span class="line">    <span class="keyword">select</span> <span class="string">"キヨシ"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span> &#123;</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> zdg = <span class="keyword">new</span> ZundokoGenerator().RandomZunDoko();</span><br><span class="line">    <span class="keyword">var</span> sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">      sb.Clear();</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i) &#123;</span><br><span class="line">        zdg.MoveNext();</span><br><span class="line">        sb.Append(zdg.Current);</span><br><span class="line">      &#125;</span><br><span class="line">      ++count;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> kys = KiyoshiParser.zzzd.Parse(sb.ToString());</span><br><span class="line">        Console.WriteLine(sb.ToString() + kys);</span><br><span class="line">        Console.WriteLine(count + <span class="string">"回ズンドコしました"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (Sprache.ParseException) &#123;</span><br><span class="line">        Console.WriteLine(sb.ToString());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解説"><a href="#解説" class="headerlink" title="解説"></a>解説</h2><h3 id="ZundokoGenerator"><a href="#ZundokoGenerator" class="headerlink" title="ZundokoGenerator"></a>ZundokoGenerator</h3><p>クラス <code>ZundokoGenerator</code> は元になった記事からパクってきましたが、実は <code>UnityEngine.Random</code> が使われていたので、 <code>System.Random</code> を使うように変更しました。</p>
<p><code>IEnumerator</code> で、ズン or ドコを延々と返すだけですね。</p>
<h3 id="KiyoshiParser"><a href="#KiyoshiParser" class="headerlink" title="KiyoshiParser"></a>KiyoshiParser</h3><p>パーサ本体です。</p>
<p>文法についてはなんとなく見てもらえば解ると思いますが、 LINQ のクエリ構文で繋いでいく感じです。</p>
<p>詳しいところは <code>Sprache</code> のドキュメントをあたってもらった方がいいと思いますが、 <code>bison</code> や <code>yacc</code> でいうパターンを <code>from</code> の羅列で記述し、 <code>select</code> でアクションといった感じです。</p>
<p>注意する点は、 <code>Parse.String()</code> は返値が <code>IEnumerator&lt;char&gt;</code> (だっけ？)になっているので、 <code>string</code> に変換してやる必要があるところです。</p>
<h3 id="Program"><a href="#Program" class="headerlink" title="Program"></a>Program</h3><p>メインの処理です。</p>
<p>正しくないズンドコ(?)の際は例外で処理しています。</p>
<h2 id="コンパイル＆結果"><a href="#コンパイル＆結果" class="headerlink" title="コンパイル＆結果"></a>コンパイル＆結果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">% mcs main.cs -r:Sprache.dll ; mono main.exe</span><br><span class="line">ドコズンズンズンズン</span><br><span class="line">ズンズンズンズンズン</span><br><span class="line">ドコドコズンドコズン</span><br><span class="line">ドコズンドコズンズン</span><br><span class="line">ドコズンズンドコズン</span><br><span class="line">ドコドコズンドコズン</span><br><span class="line">ズンドコドコズンズン</span><br><span class="line">ドコズンドコドコズン</span><br><span class="line">ズンドコズンズンドコ</span><br><span class="line">ズンドコズンドコドコ</span><br><span class="line">ズンドコドコズンズン</span><br><span class="line">ドコドコズンドコズン</span><br><span class="line">ズンドコドコズンドコ</span><br><span class="line">ドコドコズンズンズン</span><br><span class="line">ドコズンドコズンドコ</span><br><span class="line">ドコズンズンズンズン</span><br><span class="line">ズンドコドコドコズン</span><br><span class="line">ズンズンズンズンドコキヨシ</span><br><span class="line">18回ズンドコしました</span><br></pre></td></tr></table></figure>

<p>簡単ですね(‘ω`)</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fum1h1ro.github.io/2020/03/29/Kiyoshi_Check/" data-id="ck9zb3lch000b3zpkaane573r" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/c/" rel="tag">c#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qiita/" rel="tag">qiita</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-UnityEditorConnection" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/29/UnityEditorConnection/" class="article-date">
  <time datetime="2020-03-29T11:00:00.000Z" itemprop="datePublished">2020-03-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/29/UnityEditorConnection/">UnityEditor と実機間で通信がしたい</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="UnityEditorとビルド後の実機との間で通信がしたい"><a href="#UnityEditorとビルド後の実機との間で通信がしたい" class="headerlink" title="UnityEditorとビルド後の実機との間で通信がしたい"></a>UnityEditorとビルド後の実機との間で通信がしたい</h1><p>表題の件を、色々と今まで試行錯誤しつつやっていたんですが、公式で <code>PlayerConnection</code> が実装され、晴れて自前実装がお役御免になりそうです。<br>なんか勿体ないので記録として残しておこうかと思って書きました。決してContribute稼ぎではな（ｒｙ</p>
<h2 id="昔のお話"><a href="#昔のお話" class="headerlink" title="昔のお話"></a>昔のお話</h2><p>昔々、CD-ROMというメディアでゲームが提供されていた時代のことですが、当然開発中にテストをする際もCD-ROMにゲームを焼く(書き込む)必要がありました。</p>
<p>しかし、CD-ROMに焼くのも時間がかかる。下手したら現在のビルド〜転送よりも時間がかかる。更に言えば、当時のライターは焼きに失敗することもままあり、ブランクのCD-ROMもタダじゃない。</p>
<p>では、昔の人は実機で確認する際にどうしたのかというと、開発に使っているパソコン(プログラムを書いたりコンパイルしたりする)のHDDを実機からCD-ROMドライブに見えるようにエミュレートしてました。そうすると、実行されているプログラムからCD-ROMのファイルを読もうとした際に、自動的にHDDから読み込むようになっていました。</p>
<h2 id="現代でよくある話"><a href="#現代でよくある話" class="headerlink" title="現代でよくある話"></a>現代でよくある話</h2><ul>
<li><p>パターン1</p>
<ol>
<li>UnityEditor上で開発、良い感じになったのでビルド、実機(iOS/Android等)へ転送</li>
<li>実機で動いたけど、動いたけど……ちょっと操作感覚が気にくわないから調整するか</li>
<li>UnityEditor上で調整、再度ビルド、実機へ転送</li>
<li>実機で確認。うーんなにか違うな……</li>
<li>再度ビルド……</li>
</ol>
</li>
<li><p>パターン2</p>
<ol>
<li>UnityEditor上で開発、今度はマスターデータを外部から読み込むようにしたのでいちいちビルドしなくて平気だぜ</li>
<li>マスターデータが一カ所にしかない、あっても本番と検証の二カ所程度なので、複数人でいじると死ぬ</li>
</ol>
</li>
</ul>
<p>どちらも、ビルド〜転送が秒で完了すれば解決する話なんですが、それは現実的ではない。</p>
<p>もしくは、<a href="https://docs.unity3d.com/2018.1/Documentation/Manual/UnityRemote5.html" target="_blank" rel="noopener">UnityRemote</a>でなんとかするというのもありますが、公式的にもあまり活用されていないので、微妙感。</p>
<p>調整したいものが、数値のような単純なものであれば実機用のデバッグメニューを用意して調整することも可能ですが、限界もあります。</p>
<p>UnityEditorはよくできてますし、たいていの場合UnityEditor上で動くものは実機でも同じように動きます。また、外部のゲームコントローラを使うようなゲーム機の場合はコントローラが同じなら、UnityEditorでもそこそこ操作感覚は変わりません。</p>
<h2 id="現代で解決するには"><a href="#現代で解決するには" class="headerlink" title="現代で解決するには"></a>現代で解決するには</h2><p>実機とホストで通信が簡単に行えて、ファイルの転送ができれば良いんで、構造的に採用したのは、</p>
<ul>
<li>ホスト側でHTTPサーバを立てる</li>
<li>実機側からホストにHTTPリクエストを投げる</li>
</ul>
<p>という方法を採用しました。</p>
<p>初期はホスト側のHTTPサーバをRubyで実行してたりしたのですが、Editorと別に起動しなくてはいけない点が面倒くさくて、<br>最終的にはEditorWindow内で <code>HttpListener</code> を使ってHTTPサーバを実行しました。</p>
<h2 id="具体的な実装方法"><a href="#具体的な実装方法" class="headerlink" title="具体的な実装方法"></a>具体的な実装方法</h2><p>ここから、明日から役に立たないUnity情報です。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HostIOWindow</span> : <span class="title">EditorWindow</span> &#123;</span><br><span class="line">  [<span class="meta">MenuItem(<span class="meta-string">"Window/HostIO"</span>)</span>]</span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Open</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> win = (HostIOWindow)EditorWindow.GetWindow(<span class="keyword">typeof</span>(HostIOWindow));</span><br><span class="line">    win.Show();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">static</span> HostIOWindow _instance = <span class="literal">null</span>;</span><br><span class="line">  HttpListener _listener;</span><br><span class="line">  Task&lt;HttpListenerContext&gt; _task;</span><br><span class="line">  IPAddress _local;</span><br><span class="line">  <span class="keyword">byte</span>[] _ip;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!HttpListener.IsSupported) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> NotSupportedException(<span class="string">"not supported"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (_task == <span class="literal">null</span>) &#123;</span><br><span class="line">      _task = _listener.GetContextAsync();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (_task.IsCompleted) &#123;</span><br><span class="line">        <span class="keyword">var</span> ctxt = _task.Result;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          RequestHandler(ctxt);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (WebException e) &#123;</span><br><span class="line">          ErrorHandler(ctxt, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">          _task.Dispose();</span><br><span class="line">          _task = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">if</span> (_task.IsCanceled) &#123;</span><br><span class="line">          _task.Dispose();</span><br><span class="line">          _task = <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">          <span class="keyword">if</span> (_task.IsFaulted) &#123;</span><br><span class="line">            _task.Dispose();</span><br><span class="line">            _task = <span class="literal">null</span>;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Repaint();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// サーバ起動</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">StartWebServer</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    StopWebServer();</span><br><span class="line">    _task = <span class="literal">null</span>;</span><br><span class="line">    _ip = HostIOUtil.DetectLocalAddress();</span><br><span class="line">    _listener = <span class="keyword">new</span> HttpListener();</span><br><span class="line">    _listener.Prefixes.Add(<span class="string">"http://localhost:4649/"</span>);</span><br><span class="line">    <span class="keyword">var</span> url = <span class="keyword">string</span>.Format(<span class="string">"http://&#123;0&#125;.&#123;1&#125;.&#123;2&#125;.&#123;3&#125;:4649/"</span>, _ip[<span class="number">0</span>], _ip[<span class="number">1</span>], _ip[<span class="number">2</span>], _ip[<span class="number">3</span>]);</span><br><span class="line">    _listener.Prefixes.Add(url);</span><br><span class="line">    _listener.Start();</span><br><span class="line">    Debug.Log(<span class="string">"START WEB SERVER =&gt; "</span> + url);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// リクエストハンドラ</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">RequestHandler</span>(<span class="params">HttpListenerContext ctxt</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> req = ctxt.Request;</span><br><span class="line">    <span class="keyword">var</span> res = ctxt.Response;</span><br><span class="line">    <span class="keyword">var</span> pathelem = req.RawUrl.Split(<span class="string">'/'</span>).ToList();</span><br><span class="line">    pathelem.RemoveAll((e) =&gt; <span class="keyword">string</span>.IsNullOrEmpty(e));</span><br><span class="line">    <span class="keyword">if</span> (pathelem.Count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">switch</span> (pathelem[<span class="number">0</span>]) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"assets"</span>:</span><br><span class="line">        <span class="keyword">if</span> (pathelem.Count == <span class="number">1</span>) &#123;</span><br><span class="line">          RequestHandler_file(ctxt, <span class="string">"/"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">var</span> pathname = <span class="string">"/"</span> + Path.Combine(pathelem.GetRange(<span class="number">1</span>, pathelem.Count - <span class="number">1</span>).ToArray());</span><br><span class="line">          pathname = pathname.Replace(<span class="string">'\\'</span>, <span class="string">'/'</span>);</span><br><span class="line">          RequestHandler_file(ctxt, pathname);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"ping"</span>:</span><br><span class="line">        RequestHandler_ping(ctxt);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> WebException(<span class="string">"unknown API"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> WebException(<span class="string">"unknown API"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>色々端折ってますが、だいたいこんな感じでUnityEditor側のサーバを起動します。</p>
<p>次は実機側ですが、以下のような感じになります。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HostIO</span> : <span class="title">MonoBehaviour</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> HostIO _instance = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">byte</span> _pinCode = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">static</span> StringBuilder _addressBase = <span class="keyword">new</span> StringBuilder(<span class="number">1024</span>);</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">int</span> _addressBaseRewindLength;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">bool</span> _connect;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">byte</span>[] _ip;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="keyword">string</span> _saveKey = <span class="string">"HostIO"</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="keyword">string</span> _savePINCodeKey = _saveKey + <span class="string">"_PINCode"</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">float</span> _wait = <span class="number">1.0f</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> HostIO Instance &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123; <span class="keyword">return</span> _instance; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span> PINCode &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123; <span class="keyword">return</span> _pinCode; &#125;</span><br><span class="line">    <span class="keyword">set</span> &#123;</span><br><span class="line">      _pinCode = <span class="keyword">value</span>;</span><br><span class="line">      _addressBase.Clear();</span><br><span class="line">      _addressBase.Append(<span class="keyword">string</span>.Format(<span class="string">"http://&#123;0&#125;.&#123;1&#125;.&#123;2&#125;.&#123;3&#125;"</span>, _ip[<span class="number">0</span>], _ip[<span class="number">1</span>], _ip[<span class="number">2</span>], <span class="keyword">value</span>));</span><br><span class="line">      _addressBase.Append(<span class="string">":3751"</span>);</span><br><span class="line">      _addressBaseRewindLength = _addressBase.Length;</span><br><span class="line">      Debug.Log(<span class="string">"SERVER: "</span> + _addressBase.ToString());</span><br><span class="line">      _wait = <span class="number">0.0f</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> IsConnected &#123;</span><br><span class="line">    <span class="keyword">get</span> &#123; <span class="keyword">return</span> _connect; &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">    <span class="comment">// UnityEditor上で起動した場合は不要なので死ぬ</span></span><br><span class="line">    _ip = <span class="literal">null</span>;</span><br><span class="line">    Destroy(<span class="keyword">this</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="comment">// みんな大好きシングルトン</span></span><br><span class="line">    <span class="keyword">if</span> (_instance != <span class="literal">null</span>) &#123;</span><br><span class="line">      Destroy(<span class="keyword">this</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      _connect = <span class="literal">false</span>;</span><br><span class="line">      _instance = <span class="keyword">this</span>;</span><br><span class="line">      DontDestroyOnLoad(gameObject);</span><br><span class="line">      _ip = HostIOUtil.DetectLocalAddress();</span><br><span class="line">      PINCode = (<span class="keyword">byte</span>)PlayerPrefs.GetInt(_savePINCodeKey, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">OnDestroy</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (_instance == <span class="keyword">this</span>) &#123;</span><br><span class="line">      PlayerPrefs.SetInt(_savePINCodeKey, (<span class="keyword">int</span>)PINCode);</span><br><span class="line">      PlayerPrefs.Save();</span><br><span class="line">      _connect = <span class="literal">false</span>;</span><br><span class="line">      _instance = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    StartCoroutine(ConnectServer());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 定期的にHTTPサーバにPingしてサーバが生きているかどうかチェックする</span></span><br><span class="line">  <span class="function">IEnumerator <span class="title">ConnectServer</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (PINCode != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">using</span> (<span class="keyword">var</span> webreq = UnityWebRequest.Get(MakeAPIUrl(<span class="string">"/ping"</span>))) &#123;</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">return</span> webreq.SendWebRequest();</span><br><span class="line">            <span class="keyword">if</span> (webreq.isNetworkError || webreq.isHttpError) &#123;</span><br><span class="line">              _connect = <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              _connect = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        _connect = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="function"><span class="keyword">yield</span> return new <span class="title">WaitForSecondsRealtime</span>(<span class="params"><span class="number">1.0f</span></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 同期的にファイルを読む</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span>[] <span class="title">LoadFile</span>(<span class="params"><span class="keyword">string</span> path</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> webreq = UnityWebRequest.Get(MakeAPIUrl(<span class="string">"/assets"</span> + path))) &#123;</span><br><span class="line">      <span class="keyword">var</span> <span class="keyword">async</span> = webreq.SendWebRequest();</span><br><span class="line">      <span class="keyword">while</span> (!<span class="keyword">async</span>.isDone) &#123;</span><br><span class="line">        Thread.Sleep(<span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">var</span> req = <span class="keyword">async</span>.webRequest;</span><br><span class="line">      <span class="keyword">if</span> (req.isNetworkError || req.isHttpError) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> req.downloadHandler.data;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 非同期的にファイルを読む</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UnityWebRequestAsyncOperation <span class="title">LoadFileAsync</span>(<span class="params"><span class="keyword">string</span> path</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">using</span> (<span class="keyword">var</span> webreq = UnityWebRequest.Get(MakeAPIUrl(<span class="string">"/assets"</span> + path))) &#123;</span><br><span class="line">      <span class="keyword">return</span> webreq.SendWebRequest();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>これまた色々端折ってますが、だいたいこんな感じです。</p>
<p>注意点としては、 <code>Resources</code> などのように <code>UnityObject</code> として返ってくることがない点です。あくまで <code>byte[]</code> として読めるだけです。その後の処置に関しては、そこそこ苦労しています。</p>
<p>いきなりソースをぶちまけてみましたが、簡単に流れを説明すると、</p>
<ul>
<li>UnityEditor側<ol>
<li>EditorWindowを作る</li>
<li>その中でHttpListenerを作り、待ち受けを開始する</li>
<li>ホストのIPアドレスを取得しておき表示する</li>
<li>HTTPリクエストがあったらそれに応じて処理する</li>
</ol>
</li>
<li>実機側<ol>
<li>指定されたIPアドレスと通信を開始する</li>
<li>定期的にPingを発して通信状況を確認する</li>
<li>何かしらファイルが読みたくなったらHTTPサーバに問い合わせる</li>
</ol>
</li>
</ul>
<p>実機側でのIPアドレス指定ですが、SRDebuggerを利用し、デバッグメニューから指定できるようにしてあります。また、一度指定したアドレスは <code>PlayerPrefs</code> に保存しておき、次回以降は使い回します（アドレス振り直しは頻繁に起こらないだろうという予測）。</p>
<h2 id="具体的な用例"><a href="#具体的な用例" class="headerlink" title="具体的な用例"></a>具体的な用例</h2><ul>
<li><a href="https://github.com/Tencent/xLua" target="_blank" rel="noopener">xLua</a>のようなスクリプトで処理を記述するゲームの場合、スクリプトを修正する度にビルドしてたら日が暮れるので、ホストPC上のスクリプトを更新したら実機側でそのままリロードできるようにしました。</li>
<li><code>StreamingAssets</code> に埋め込むようなAssetBundleを更新する度にビルドしてたら……なので、リロードできるようにしました。</li>
</ul>
<h2 id="最後に"><a href="#最後に" class="headerlink" title="最後に"></a>最後に</h2><p>長々と書いてきましたが、今まで書いた内容はほぼ無効です。 <code>PlayerConnection</code> を使いましょう。もっと簡単に安定して通信が出来るはずです。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://fum1h1ro.github.io/2020/03/29/UnityEditorConnection/" data-id="ck9zb3lcj000e3zpk0w16ffyp" class="article-share-link">共有</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/qiita/" rel="tag">qiita</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/unity/" rel="tag">unity</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">次へ &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグ</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/arduboy/" rel="tag">arduboy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/c/" rel="tag">c#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dev/" rel="tag">dev</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ios/" rel="tag">ios</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/objc/" rel="tag">objc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/qiita/" rel="tag">qiita</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unity/" rel="tag">unity</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグクラウド</h3>
    <div class="widget tagcloud">
      <a href="/tags/arduboy/" style="font-size: 16.67px;">arduboy</a> <a href="/tags/c/" style="font-size: 10px;">c#</a> <a href="/tags/dev/" style="font-size: 20px;">dev</a> <a href="/tags/ios/" style="font-size: 10px;">ios</a> <a href="/tags/objc/" style="font-size: 10px;">objc</a> <a href="/tags/qiita/" style="font-size: 20px;">qiita</a> <a href="/tags/unity/" style="font-size: 13.33px;">unity</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">アーカイブ</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最近の投稿</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/03/30/Arduboy_move_tofu/">Arduboy で豆腐を動かす</a>
          </li>
        
          <li>
            <a href="/2020/03/29/Arduboy_1st/">Arduboy ことはじめ</a>
          </li>
        
          <li>
            <a href="/2020/03/29/Arduboy_OLED/">Arduboy のOLEDを叩く</a>
          </li>
        
          <li>
            <a href="/2020/03/29/Arduboy_framebuffer/">Arduboy のフレームバッファ</a>
          </li>
        
          <li>
            <a href="/2020/03/29/Arduboy_measure_1frame/">1フレームの時間を測る</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 fum1h1ro<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>